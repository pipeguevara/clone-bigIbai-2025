---
import { actions } from "astro:actions";
---

<section class="w-full max-w-xl mx-auto">
  <form
    id="newsletter-form"
    class="flex flex-col gap-4"
    action={actions.newsletter}
    method="POST"
  >
    <div class="flex flex-col sm:flex-row gap-3">
      <input
        class="flex-1 px-4 py-3 rounded-lg bg-black/30 border border-white/20 backdrop-blur-lg
       text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-brand focus:border-transparent transition-all"
        name="email"
        type="email"
        required
        placeholder="123@gmail.com"
      />
      <button
        class="px-6 py-3 bg-brand text-black font-bold rounded-lg hover:bg-brand hover:scale-105 transition-all
      active:scale-95"
        type="submit">Enviar</button
      >
    </div>
    <div id="newsletter-message" class="hidden text-sm text-center text-brand">
      ya eres parte de la newsletter
    </div>
  </form>
</section>

<script>
  import { actions } from "astro:actions";
  import { throwConfetti } from "../../utils/confetti";
  

  const form = document.getElementById("newsletter-form") as HTMLFormElement | null;
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const email=formData.get('email') as string;

    const { data, error } = await actions.newsletter({ email });
    if(error){
      console.error(error);
    }
    if(data){
      console.log(data);
      throwConfetti();
    }

  });
</script>
